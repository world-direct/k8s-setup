- hosts: localhost
  tasks:

    - set_fact:

        # this file has been fetched from the lnx_setup host, by the lnxclp-new role
        # playbook_dir is undocumented, but check the source:
        # https://github.com/ansible/ansible/blob/143bafec9a506aff8f42ca573c7006a8c5549e12/lib/ansible/vars/hostvars.py#L40
        charts_dir: "{{playbook_dir}}/../charts"

      no_log: yes

    - name: "run 'use-context' for verification"
      shell: "{{playbook_dir}}/../../.local/scripts/use-context"

    - name: "k8s: kube-flannel namespace"
      wd_k8snamespace:
        namespace: kube-flannel

    - name: "k8s: chart wd-flannel"
      wd_helm3:
        chart: "{{ charts_dir }}/wd-flannel"
        namespace: kube-flannel

    - name: "k8s: kube-metallb namespace"
      wd_k8snamespace:
        namespace: kube-metallb

    - name: "k8s: chart wd-metallb"
      wd_helm3:
        chart: "{{ charts_dir }}/wd-metallb"
        namespace: kube-metallb
        values:
          ip_range_start: "{{k8s_metallb_ip_start}}"
          ip_range_end: "{{k8s_metallb_ip_end}}"

    - name: "k8s: kube-dashboard namespace"
      wd_k8snamespace:
        namespace: kube-dashboard

    - name: "k8s: wd-k8sdashboard"
      wd_helm3:
        chart: "{{ charts_dir }}/wd-k8sdashboard"
        namespace: kube-dashboard
        values:
          cluster_display_name: "{{k8s_cluster_dnsname}}"

    - name: "k8s: kube-haproxy-ingress namespace"
      wd_k8snamespace:
        namespace: kube-haproxy-ingress

    - name: "k8s: wd-haproxy-ingress"
      wd_helm3:
        chart: "{{ charts_dir }}/wd-haproxy-ingress"
        namespace: kube-haproxy-ingress




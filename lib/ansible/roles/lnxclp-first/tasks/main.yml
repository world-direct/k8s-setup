###########################################
## This is the role which initializes the cluster on the lnxclp_setup node
##
## It is dynamically included by cluster.yml playbook

- name: clustersetup - sync ./initk8s init script
  template:
    src: initk8s
    dest: "{{ k8s_setup_dir }}/initk8s"
    mode: 755

- name: "clustersetup - running init script (you may cat {{ k8s_setup_logdir }}/kubeadm.log to check progress"
  shell: "{{ k8s_setup_dir }}/initk8s >> {{ k8s_setup_logdir }}/kubeadm.log"

- name: clustersetup - fetch admin.conf to provisioning client for later import
  fetch:
    src: /etc/kubernetes/admin.conf

    # this is relative to the /lib/ansible directory on localhost
    dest: "../../.local/admin.conf"
    flat: true
